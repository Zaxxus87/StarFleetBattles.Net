@using StarFleetBattles.Domain.ValueObjects
@using StarFleetBattles.Application.Services
@inject IEnergyAllocationService EnergyService

<div class="energy-form-container">
    <div class="button-bar">
        <button type="button" @onclick="SaveCurrentTurn" class="btn btn-primary">Save Turn @currentTurn</button>
        <button type="button" @onclick="ShowShip" class="btn btn-info">Ship</button>
    </div>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="error-message">@errorMessage</div>
    }
    @if (!string.IsNullOrEmpty(successMessage))
    {
        <div class="success-message">@successMessage</div>
    }

    <div class="grid-container">
        <table class="energy-grid">
            <thead>
                <tr>
                    <th class="row-label">System</th>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        <th class="turn-header @(turn == currentTurn ? "current-turn" : "")">
                            @turn @(turn == currentTurn ? "★" : "")
                        </th>
                    }
                </tr>
            </thead>
            <tbody>
                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">POWER GENERATION</td>
                </tr>
                <tr>
                    <td class="row-label">Warp Engine Power</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.WarpEnginePower" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.WarpEnginePower</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Impulse Engine Power</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ImpulseEnginePower" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ImpulseEnginePower</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Reactor Power (AWR)</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ReactorPower" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ReactorPower</span>
                            }
                        </td>
                    }
                </tr>
                <tr class="calculated-row">
                    <td class="row-label">Total Power Available</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var turnData = GetTurnData(turn);
                        <td class="calculated-cell">@turnData.TotalPowerAvailable</td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Battery Power Available</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.BatteryPowerAvailable" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.BatteryPowerAvailable</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Battery Capacity Discharged</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.BatteryCapacityDischarged" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.BatteryCapacityDischarged</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">ESSENTIAL SYSTEMS</td>
                </tr>
                <tr>
                    <td class="row-label">Life Support</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.LifeSupport" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.LifeSupport</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Damage Control</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.DamageControl" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.DamageControl</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">WEAPONS & EQUIPMENT</td>
                </tr>
                <tr>
                    <td class="row-label">Active Fire Control</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ActiveFireControl" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ActiveFireControl</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Charge Phaser Capacitors</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ChargePhaser" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ChargePhaser</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Heavy Weapons A</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.HeavyWeaponsA" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.HeavyWeaponsA</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Heavy Weapons B</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.HeavyWeaponsB" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.HeavyWeaponsB</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Heavy Weapons C</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.HeavyWeaponsC" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.HeavyWeaponsC</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Heavy Weapons D</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.HeavyWeaponsD" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.HeavyWeaponsD</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">ECCM</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ECCM" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ECCM</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Sensor Channels</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SensorChannels" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SensorChannels</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Other Equipment</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.OtherEquipment" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.OtherEquipment</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">DEFENSE</td>
                </tr>
                <tr>
                    <td class="row-label">Activate Shields</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ActivateShields" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ActivateShields</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">General Reinforcement</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.GeneralReinforcement" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.GeneralReinforcement</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Specific Reinforcement 1</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SpecificReinforcement1" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SpecificReinforcement1</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Specific Reinforcement 2</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SpecificReinforcement2" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SpecificReinforcement2</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Specific Reinforcement 3</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SpecificReinforcement3" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SpecificReinforcement3</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Specific Reinforcement 4</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SpecificReinforcement4" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SpecificReinforcement4</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Specific Reinforcement 5</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SpecificReinforcement5" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SpecificReinforcement5</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Specific Reinforcement 6</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.SpecificReinforcement6" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.SpecificReinforcement6</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">ECM</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ECM" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ECM</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">MOVEMENT</td>
                </tr>
                <tr>
                    <td class="row-label">HET (High Energy Turn)</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.HET" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.HET</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Emergency Braking Energy</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.EmergencyBrakingEnergy" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.EmergencyBrakingEnergy</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">OTHER SYSTEMS</td>
                </tr>
                <tr>
                    <td class="row-label">Recharge Batteries</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.RechargeBatteries" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.RechargeBatteries</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Tractor Beam</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.TractorBeam" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.TractorBeam</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Transporters</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.Transporters" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.Transporters</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Labs</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.Labs" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.Labs</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Charge Wild Weasel</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.ChargeWildWeasel" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.ChargeWildWeasel</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Cloaking Device</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.CloakingDevice" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.CloakingDevice</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">SUMMARY</td>
                </tr>
                <tr class="calculated-row">
                    <td class="row-label">Total Power Used</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var turnData = GetTurnData(turn);
                        var powerUsed = turnData.TotalPowerUsed;
                        var powerAvailable = turnData.TotalPowerAvailable + turnData.BatteryPowerAvailable;
                        var cssClass = powerUsed > powerAvailable ? "over-power" : "";
                        <td class="calculated-cell @cssClass">@powerUsed</td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Battery Power Used</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.BatteryPowerUsed" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.BatteryPowerUsed</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Phaser Capacitors Charged</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.PhaserCapacitorsCharged" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.PhaserCapacitorsCharged</span>
                            }
                        </td>
                    }
                </tr>
                <tr>
                    <td class="row-label">Phaser Capacitors Used</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="number" @bind="turnData.PhaserCapacitorsUsed" @bind:event="oninput" class="grid-input" />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.PhaserCapacitorsUsed</span>
                            }
                        </td>
                    }
                </tr>

                <tr class="section-header">
                    <td colspan="@(currentTurn + 1)">MOVEMENT PLOT / NOTES</td>
                </tr>
                <tr>
                    <td class="row-label">Notes</td>
                    @for (int turn = 1; turn <= currentTurn; turn++)
                    {
                        var t = turn;
                        var turnData = GetTurnData(t);
                        <td>
                            @if (t == currentTurn)
                            {
                                <input type="text" @bind="turnData.MovementPlotNotes" @bind:event="oninput" class="grid-input-text" placeholder="Notes..." />
                            }
                            else
                            {
                                <span class="readonly-value">@turnData.MovementPlotNotes</span>
                            }
                        </td>
                    }
                </tr>
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter] public int CurrentTurn { get; set; }
    [Parameter] public EventCallback OnShowShip { get; set; }

    private int currentTurn = 1;
    private Dictionary<int, EnergyAllocationModel> turnDataCache = new();
    private string errorMessage = string.Empty;
    private string successMessage = string.Empty;

    protected override void OnInitialized()
    {
        currentTurn = CurrentTurn > 0 ? CurrentTurn : 1;
        LoadTurns();
    }

    protected override void OnParametersSet()
    {
        if (CurrentTurn != currentTurn && CurrentTurn > 0)
        {
            currentTurn = CurrentTurn;
            LoadTurns();
            errorMessage = string.Empty;
            successMessage = string.Empty;
        }
    }

    private void LoadTurns()
    {
        try
        {
            turnDataCache.Clear();

            for (int i = 1; i <= currentTurn; i++)
            {
                var turn = EnergyService.GetTurn(i);
                if (turn != null)
                {
                    turnDataCache[i] = turn;
                }
            }
            StateHasChanged();
        }
        catch (Exception ex)
        {
            errorMessage = $"Error loading turns: {ex.Message}";
        }
    }

    private EnergyAllocationModel GetTurnData(int turnNumber)
    {
        if (!turnDataCache.ContainsKey(turnNumber))
        {
            var turn = EnergyService.GetTurn(turnNumber);
            if (turn != null)
            {
                turnDataCache[turnNumber] = turn;
            }
        }
        return turnDataCache.ContainsKey(turnNumber) ? turnDataCache[turnNumber] : new EnergyAllocationModel { TurnNumber = turnNumber };
    }

    private void SaveCurrentTurn()
    {
        try
        {
            errorMessage = string.Empty;
            successMessage = string.Empty;

            if (!EnergyService.ValidateTurn(currentTurn, out var error))
            {
                errorMessage = $"Turn {currentTurn}: {error}";
                return;
            }

            EnergyService.UpdateTurn(currentTurn, turnDataCache[currentTurn]);
            successMessage = "Turn saved successfully!";
        }
        catch (Exception ex)
        {
            errorMessage = $"Error saving turn: {ex.Message}";
        }
    }

    private async Task ShowShip()
    {
        await OnShowShip.InvokeAsync();
    }
}

<style>
    .energy-form-container {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .button-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
    }

    .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        border: 1px solid #f5c6cb;
    }

    .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        border: 1px solid #c3e6cb;
    }

    .grid-container {
        overflow: auto;
        flex: 1;
    }

    .energy-grid {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
    }

        .energy-grid th,
        .energy-grid td {
            border: 1px solid #ddd;
            padding: 6px 4px;
            text-align: center;
        }

        .energy-grid thead th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

    .turn-header {
        min-width: 70px;
    }

    .current-turn {
        background-color: #ffc107 !important;
        color: black !important;
    }

    .row-label {
        text-align: left !important;
        font-weight: 500;
        background-color: #f8f9fa;
        position: sticky;
        left: 0;
        z-index: 5;
        min-width: 200px;
        padding-left: 10px !important;
    }

    .section-header td {
        background-color: #007bff;
        color: white;
        font-weight: bold;
        text-align: center !important;
        padding: 8px;
        font-size: 13px;
    }

    .grid-input {
        width: 60px;
        padding: 4px;
        border: 1px solid #ccc;
        border-radius: 3px;
        text-align: center;
        font-size: 12px;
    }

        .grid-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 3px rgba(0, 123, 255, 0.5);
        }

    .grid-input-text {
        width: 100%;
        padding: 4px;
        border: 1px solid #ccc;
        border-radius: 3px;
        font-size: 11px;
    }

        .grid-input-text:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 3px rgba(0, 123, 255, 0.5);
        }

    .readonly-value {
        color: #666;
        font-weight: normal;
    }

    .calculated-row {
        background-color: #e9ecef;
        font-weight: bold;
    }

    .calculated-cell {
        background-color: #e9ecef;
        font-weight: bold;
        color: #495057;
    }

    .over-power {
        background-color: #f8d7da !important;
        color: #721c24 !important;
        font-weight: bold;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

        .btn-primary:hover {
            background-color: #0056b3;
        }

    .btn-info {
        background-color: #17a2b8;
        color: white;
    }

        .btn-info:hover {
            background-color: #138496;
        }
</style>